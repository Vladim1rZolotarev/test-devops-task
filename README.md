# DevOps-инфраструктура для сайта CV

## Описание проекта

Данный проект представляет собой полноценную DevOps-инфраструктуру для развертывания веб-приложения с использованием современных инструментов и практик. Проект был создан в рамках тестового задания на позицию DevOps Junior в компанию [ООО «Интеллектика»](https://intellectika.ru/), чтобы продемонстрировать навыки в области автоматизации, настройки CI/CD, мониторинга и обеспечения надёжности инфраструктуры. ***Но в процесе выполнения я так увлёкся, что на базе созданной инфраструктуры реализовал свой сайт CV.***

Реализованы следующие компоненты:
- Автоматическое развертывание через CI/CD (GitHub Actions)
- Контейнеризация (Docker, Docker Compose)
- Мониторинг (Prometheus, Grafana, Node Exporter)
- Логирование (Loki, Promtail)
- Балансировка нагрузки (Nginx)
- Механизм отката (rollback)
- Кэширование (Redis)
- Инфраструктура как код (Terraform)

## Структура проекта

```
test-devops-task/
├── .github/                 # Директория GitHub Actions (CI/CD)
|   └── workflows/           
|       └── ci-cd.yml        # Конфигурация CI/CD
├── app/                     # Директория WEB-приложения
|   ├── logs/                # Директория для логов Flask
|   ├── static/              # Директория CSS
|   |   └── styles.css       # CSS для WEB-приложения
|   ├── templates/           # Директория HTML
|   |   └── index.html       # Главная страница WEB-приложения
|   ├── main.py              # Код Flask-приложения
|   ├── requirements.txt     # Зависимости Python
├── docs/                    # Документация
|   ├── dashboards/          # Дашборды Grafana
|   |   └── flask-app-dashboard.json  # Дашборд для Flask-приложения
|   └── grafana-setup.md     # Инструкции по настройке Grafana
├── terraform/               # Инфраструктура как код
|   ├── main.tf              # Основной файл Terraform
|   ├── variables.tf         # Переменные Terraform
|   ├── terraform.tfvars.example  # Пример переменных
|   └── README.md            # Документация по Terraform
├── tests/                   # Тесты
|   └── test_app.py          # Тесты для Flask-приложения
├── Dockerfile               # Сборка Flask-приложения
├── README.md                # Основная документация
├── docker-compose.yml       # Конфигурация контейнеров
├── loki-config.yml          # Конфигурация Loki (логи)
├── nginx.conf               # Конфигурация Nginx (прокси)
├── prometheus.yml           # Конфигурация Prometheus (метрики)
├── promtail-config.yml      # Конфигурация Promtail (сбор логов)
├── alert_rules.yml          # Правила оповещений Prometheus
├── alertmanager.yml         # Конфигурация Alertmanager
└── pytest.ini               # Конфигурация pytest
```

## Установка и запуск

### Локальное развертывание

#### Клонируйте репозиторий:

```bash
git clone https://github.com/Vladim1rZolotarev/test-devops-task.git
```

#### Перейдите в директорию с проектом:

```bash
cd test-devops-task
```

#### Запустите через Docker Compose:

```bash
docker compose up --build -d
```

#### Доступ к сервисам:
- WEB-приложение/CV сайт: http://localhost
- Grafana (метрики и логи): http://localhost:3000
- Prometheus: http://localhost:9090

### Развертывание в облаке с помощью Terraform

Для автоматического развертывания в Yandex Cloud используйте Terraform:

```bash
cd terraform
cp terraform.tfvars.example terraform.tfvars
# Отредактируйте terraform.tfvars, указав свои значения
terraform init
terraform apply
```

Подробные инструкции по использованию Terraform находятся в [terraform/README.md](terraform/README.md).

### Доступ к сервисам в облаке:
- WEB-приложение/CV сайт (проксируется через Nginx): [zolotarev.tech](https://zolotarev.tech)
- Grafana (метрики и логи): [zolotarev.tech:3000](https://zolotarev.tech:3000)

## Реализованные компоненты

### 1. Веб-приложение
- Разработано WEB-приложение, представляющее собой Сайт СV (Python + Flask - бэкенд, HTML + CSS - фронтенд)
- Добавлен endpoint для health check (/health)
- Реализовано кэширование с использованием Redis
- Настроено логирование в файл
- Добавлены метрики Prometheus
- Созданы автоматические тесты

### 2. Контейнеризация и оркестрация
- Создан оптимизированный `Dockerfile` для сборки образа WEB-приложения
- Настроен Docker Compose для управления всеми сервисами
- Реализована репликация приложения (3 экземпляра)
- Настроены ограничения ресурсов для контейнеров
- Добавлены health checks для всех сервисов
- Настроены политики перезапуска для повышения отказоустойчивости

### 3. CI/CD и автоматизация
- Реализован полный CI/CD пайплайн с использованием GitHub Actions
- Добавлены этапы тестирования, сканирования безопасности, сборки и деплоя
- Настроено автоматическое определение окружения (staging/production)
- Реализован механизм автоматического отката (rollback) при неудачном деплое
- Добавлена проверка работоспособности после деплоя

### 4. Мониторинг и оповещения
- Настроен Prometheus для сбора метрик со всех сервисов
- Добавлен Node Exporter для мониторинга системных ресурсов
- Настроен Alertmanager для отправки оповещений в Telegram
- Созданы правила оповещений для критических ситуаций
- Подготовлены готовые дашборды Grafana для визуализации метрик
- Настроен мониторинг Redis

### 5. Логирование
- Настроен Loki для централизованного хранения логов
- Настроен Promtail для сбора логов из Nginx и Flask
- Реализовано структурированное логирование в формате JSON
- Добавлены панели для просмотра логов в Grafana
- Созданы примеры запросов для анализа логов

### 6. Производительность и оптимизация
- Оптимизирована конфигурация Nginx для повышения производительности
- Настроено кэширование статических файлов
- Настроено сжатие (gzip) для уменьшения объема передаваемых данных
- Добавлен Redis для кэширования данных приложения
- Оптимизированы настройки буферизации и таймаутов

### 7. Инфраструктура как код
- Создана конфигурация Terraform для автоматического развертывания в Yandex Cloud
- Настроено создание VPC, подсетей и групп безопасности
- Реализовано автоматическое создание DNS-записей
- Добавлены скрипты для автоматической настройки сервера после создания
- Подготовлена документация по использованию Terraform

## Документация

- [Настройка мониторинга в Grafana](docs/grafana-setup.md)
- [Инфраструктура как код с Terraform](terraform/README.md)
